(function () {
	var obj =  function (env, pkg, server, isSSL) {
		let me = this;
		me.mapping = {};
		me.io = require( env.root_path + '/package/socket_io/node_modules/socket.io').listen(server);
		me.io.on("connection", (socket) => {
			let me = this;
			delete require.cache[env.root_path + '/modules/io/node_modules/ioApp.js'];
			let ioAPP =  require(env.root_path + '/modules/io/node_modules/ioApp.js');
			try {
				new ioAPP(env, pkg, server, isSSL).onConnection(me, socket);
			} catch (err) {
				me.io.to(socket.id).emit('ioAppError', err.mrssage);
				socket.disconnect();
			}
			socket.on("disconnect", () => {
				console.log('---socket-disconnection---');
			});
		});		
	};
	
	if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {
		module.exports = obj;
	} 
	
})();
